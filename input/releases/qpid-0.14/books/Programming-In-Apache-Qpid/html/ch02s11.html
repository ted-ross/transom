<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>2.11. Maps and Lists in Message Content</title><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><link rel="home" href="index.html" title="Programming in Apache Qpid"><link rel="up" href="ch02.html" title="Chapter 2. Using the Qpid Messaging API"><link rel="prev" href="ch02s10.html" title="2.10. Connection Options"><link rel="next" href="ch02s12.html" title="2.12. The Request / Response Pattern"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2.11. Maps and Lists in Message Content</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch02s10.html">Prev</a> </td><th width="60%" align="center">Chapter 2. Using the Qpid Messaging API</th><td width="20%" align="right"> <a accesskey="n" href="ch02s12.html">Next</a></td></tr></table><hr></div><div class="section" title="2.11. Maps and Lists in Message Content"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="section-Maps"></a>2.11. Maps and Lists in Message Content</h2></div></div></div><p>Many messaging applications need to exchange data across
      languages and platforms, using the native datatypes of each
      programming language.</p><p>The Qpid Messaging API supports <code class="classname">map</code> and <code class="classname">list</code> in message content.

      <sup>[<a name="id549680" href="#ftn.id549680" class="footnote">9</a>]</sup>

			<sup>[<a name="id549685" href="#ftn.id549685" class="footnote">10</a>]</sup>
			Specific language support for <code class="classname">map</code> and <code class="classname">list</code> objects are shown in the following table.
		 </p><div class="table"><a name="tabl-Programming_in_Apache_Qpid-Qpid_Maps_in_Message_Content"></a><p class="title"><b>Table 2.5. Map and List Representation in Supported Languages</b></p><div class="table-contents"><table summary="Map and List Representation in Supported Languages" border="1"><colgroup><col><col><col></colgroup><thead><tr><th>Language</th><th>map</th><th>list</th></tr></thead><tbody><tr><td>Python</td><td><code class="classname">dict</code></td><td><code class="classname">list</code></td></tr><tr><td>C++</td><td><code class="classname">Variant::Map</code></td><td><code class="classname">Variant::List</code></td></tr><tr><td>Java</td><td><code class="classname">MapMessage</code></td><td><code class="classname"> </code></td></tr><tr><td>.NET</td><td><code class="classname">Dictionary&lt;string, object&gt;</code></td><td><code class="classname">Collection&lt;object&gt;</code></td></tr></tbody></table></div></div><br class="table-break"><p>
			In all languages, messages are encoded using AMQP's portable datatypes.
      </p><div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3><p>Because of the differences in type systems among
      languages, the simplest way to provide portable messages is to
      rely on maps, lists, strings, 64 bit signed integers, and
      doubles for messages that need to be exchanged across languages
      and platforms.</p></div><div class="section" title="2.11.1. Qpid Maps and Lists in Python"><div class="titlepage"><div><div><h3 class="title"><a name="section-Python-Maps"></a>2.11.1. Qpid Maps and Lists in Python</h3></div></div></div><p>In Python, Qpid supports the <code class="classname">dict</code> and <code class="classname">list</code> types directly in message content. The following code shows how to send these structures in a message:</p><div class="example"><a name="id549831"></a><p class="title"><b>Example 2.15. Sending Qpid Maps and Lists in Python</b></p><div class="example-contents"><pre class="programlisting">
from qpid.messaging import *
# !!! SNIP !!!

content = {'Id' : 987654321, 'name' : 'Widget', 'percent' : 0.99}
content['colours'] = ['red', 'green', 'white']
content['dimensions'] = {'length' : 10.2, 'width' : 5.1,'depth' : 2.0};
content['parts'] = [ [1,2,5], [8,2,5] ]
content['specs'] = {'colors' : content['colours'],
                    'dimensions' : content['dimensions'],
                    'parts' : content['parts'] }
message = Message(content=content)
sender.send(message)
       </pre></div></div><br class="example-break"><p>The following table shows the datatypes that can be sent in a Python map message,
 and the corresponding datatypes that will be received by clients in Java or C++.</p><div class="table"><a name="table-Python-Maps"></a><p class="title"><b>Table 2.6. Python Datatypes in Maps</b></p><div class="table-contents"><table summary="Python Datatypes in Maps" border="1"><colgroup><col><col><col></colgroup><thead><tr><th>Python Datatype</th><th>&#8594; C++</th><th>&#8594; Java</th></tr></thead><tbody><tr><td>bool</td><td>bool</td><td>boolean</td></tr><tr><td>int</td><td>int64</td><td>long</td></tr><tr><td>long</td><td>int64</td><td>long</td></tr><tr><td>float</td><td>double</td><td>double</td></tr><tr><td>unicode</td><td>string</td><td>java.lang.String</td></tr><tr><td>uuid</td><td>qpid::types::Uuid</td><td>java.util.UUID</td></tr><tr><td>dict</td><td>Variant::Map</td><td>java.util.Map</td></tr><tr><td>list</td><td>Variant::List</td><td>java.util.List</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" title="2.11.2. Qpid Maps and Lists in C++"><div class="titlepage"><div><div><h3 class="title"><a name="section-cpp-Maps"></a>2.11.2. Qpid Maps and Lists in C++</h3></div></div></div><p>In C++, Qpid defines the the
	<code class="classname">Variant::Map</code> and
	<code class="classname">Variant::List</code> types, which can be
	encoded into message content. The following code shows how to
	send these structures in a message:</p><div class="example"><a name="id549981"></a><p class="title"><b>Example 2.16. Sending Qpid Maps and Lists in C++</b></p><div class="example-contents"><pre class="programlisting">
using namespace qpid::types;

// !!! SNIP !!!

Message message;
Variant::Map content;
content["id"] = 987654321;
content["name"] = "Widget";
content["percent"] = 0.99;
Variant::List colours;
colours.push_back(Variant("red"));
colours.push_back(Variant("green"));
colours.push_back(Variant("white"));
content["colours"] = colours;

Variant::Map dimensions;
dimensions["length"] = 10.2;
dimensions["width"] = 5.1;
dimensions["depth"] = 2.0;
content["dimensions"]= dimensions;

Variant::List part1;
part1.push_back(Variant(1));
part1.push_back(Variant(2));
part1.push_back(Variant(5));

Variant::List part2;
part2.push_back(Variant(8));
part2.push_back(Variant(2));
part2.push_back(Variant(5));

Variant::List parts;
parts.push_back(part1);
parts.push_back(part2);
content["parts"]= parts;

Variant::Map specs;
specs["colours"] = colours;
specs["dimensions"] = dimensions;
specs["parts"] = parts;
content["specs"] = specs;

encode(content, message);
sender.send(message, true);
     </pre></div></div><br class="example-break"><p>The following table shows the datatypes that can be sent
	in a C++ map message, and the corresponding datatypes that
	will be received by clients in Java and Python.</p><div class="table"><a name="table-cpp-Maps"></a><p class="title"><b>Table 2.7. C++ Datatypes in Maps</b></p><div class="table-contents"><table summary="C++ Datatypes in Maps" border="1"><colgroup><col><col><col></colgroup><thead><tr><th>C++ Datatype</th><th>&#8594; Python</th><th>&#8594; Java</th></tr></thead><tbody><tr><td>bool</td><td>bool</td><td>boolean</td></tr><tr><td>uint16</td><td>int | long</td><td>short</td></tr><tr><td>uint32</td><td>int | long</td><td>int</td></tr><tr><td>uint64</td><td>int | long</td><td>long</td></tr><tr><td>int16</td><td>int | long</td><td>short</td></tr><tr><td>int32</td><td>int | long</td><td>int</td></tr><tr><td>int64</td><td>int | long</td><td>long</td></tr><tr><td>float</td><td>float</td><td>float</td></tr><tr><td>double</td><td>float</td><td>double</td></tr><tr><td>string</td><td>unicode</td><td>java.lang.String</td></tr><tr><td>qpid::types::Uuid</td><td>uuid</td><td>java.util.UUID</td></tr><tr><td>Variant::Map</td><td>dict</td><td>java.util.Map</td></tr><tr><td>Variant::List</td><td>list</td><td>java.util.List</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" title="2.11.3. Qpid Maps and Lists in .NET"><div class="titlepage"><div><div><h3 class="title"><a name="section-dotnet-Maps"></a>2.11.3. Qpid Maps and Lists in .NET</h3></div></div></div><p>
	  The .NET binding for the Qpid Messaging API binds .NET managed data types
	  to C++ <code class="classname">Variant</code> data types.  The following code shows how to
	  send Map and List structures in a message:
	</p><div class="example"><a name="id550174"></a><p class="title"><b>Example 2.17. Sending Qpid Maps and Lists in .NET C#</b></p><div class="example-contents"><pre class="programlisting">
using System;
using Org.Apache.Qpid.Messaging;

// !!! SNIP !!!

Dictionary&lt;string, object&gt; content = new Dictionary&lt;string, object&gt;();
Dictionary&lt;string, object&gt; subMap = new Dictionary&lt;string, object&gt;();
Collection&lt;object&gt; colors = new Collection&lt;object&gt;();

// add simple types
content["id"] = 987654321;
content["name"] = "Widget";
content["percent"] = 0.99;

// add nested amqp/map
subMap["name"] = "Smith";
subMap["number"] = 354;
content["nestedMap"] = subMap;

// add an amqp/list
colors.Add("red");
colors.Add("green");
colors.Add("white");
content["colorsList"] = colors;

// add one of each supported amqp data type
bool mybool = true;
content["mybool"] = mybool;

byte mybyte = 4;
content["mybyte"] = mybyte;

UInt16 myUInt16 = 5;
content["myUInt16"] = myUInt16;

UInt32 myUInt32 = 6;
content["myUInt32"] = myUInt32;

UInt64 myUInt64 = 7;
content["myUInt64"] = myUInt64;

char mychar = 'h';
content["mychar"] = mychar;

Int16 myInt16 = 9;
content["myInt16"] = myInt16;

Int32 myInt32 = 10;
content["myInt32"] = myInt32;

Int64 myInt64 = 11;
content["myInt64"] = myInt64;

Single mySingle = (Single)12.12;
content["mySingle"] = mySingle;

Double myDouble = 13.13;
content["myDouble"] = myDouble;

Guid myGuid = new Guid("000102030405060708090a0b0c0d0e0f");
content["myGuid"] = myGuid;

Message message = new Message(content);
Send(message, true);
     </pre></div></div><br class="example-break"><p>
	  The following table shows the mapping between datatypes in .NET and C++.
	</p><div class="table"><a name="table-dotnet-Maps"></a><p class="title"><b>Table 2.8. Datatype Mapping between C++ and .NET binding</b></p><div class="table-contents"><table summary="Datatype Mapping between C++ and .NET binding" border="1"><colgroup><col><col></colgroup><thead><tr><th>C++ Datatype</th><th>&#8594; .NET binding</th></tr></thead><tbody><tr><td>void</td><td>nullptr</td></tr><tr><td>bool</td><td>bool</td></tr><tr><td>uint8</td><td>byte</td></tr><tr><td>uint16</td><td>UInt16</td></tr><tr><td>uint32</td><td>UInt32</td></tr><tr><td>uint64</td><td>UInt64</td></tr><tr><td>uint8</td><td>char</td></tr><tr><td>int16</td><td>Int16</td></tr><tr><td>int32</td><td>Int32</td></tr><tr><td>int64</td><td>Int64</td></tr><tr><td>float</td><td>Single</td></tr><tr><td>double</td><td>Double</td></tr><tr><td>string</td><td>string
          <sup>[<a name="callout-dotnet-string" href="#ftn.callout-dotnet-string" class="footnote">a</a>]</sup></td></tr><tr><td>qpid::types::Uuid</td><td>Guid</td></tr><tr><td>Variant::Map</td><td>Dictionary&lt;string, object&gt;
          <sup>[<a href="ch02s11.html#ftn.callout-dotnet-string" class="footnoteref">a</a>]</sup></td></tr><tr><td>Variant::List</td><td>Collection&lt;object&gt;
          <sup>[<a href="ch02s11.html#ftn.callout-dotnet-string" class="footnoteref">a</a>]</sup></td></tr></tbody><tbody class="footnotes"><tr><td colspan="2"><div class="footnote"><p><sup>[<a id="ftn.callout-dotnet-string" href="#callout-dotnet-string" class="para">a</a>] </sup>Strings are currently interpreted only with UTF-8 encoding.</p></div></td></tr></tbody></table></div></div><br class="table-break"></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.id549680" href="#id549680" class="para">9</a>] </sup>Unlike JMS, there is not a specific message type for
      map messages.</p></div><div class="footnote"><p><sup>[<a id="ftn.id549685" href="#id549685" class="para">10</a>] </sup>
				Note that the Qpid JMS client supports MapMessages whose values can be nested maps or lists. This is not standard JMS behaviour.
			  </p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch02s10.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch02.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch02s12.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">2.10. Connection Options </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> 2.12. The Request / Response Pattern</td></tr></table></div></body></html>
